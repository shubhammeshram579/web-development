<% include ./partial/header.ejs %>

<!-- addtocard page -->
    <link rel="stylesheet" href="/stylesheets/addtocard.css">
    <a style="text-decoration: none; color:#fff;left: 94%; padding-right: 100px; padding-top: 40px; font-size: 20px; position: fixed; z-index: 999;"
        href="/product"><i class="fa-solid fa-xmark"></i></a>
    <div class="main" style="background-color:#111; color: #fff; padding-top: 300px;">
        <div class="card"
            style="display: flex; align-items: center; justify-content: space-between;border-bottom: 1px solid gray; margin: 0px 20px;padding-bottom: 20px;">
            <h1 style="font-size: 2vh; color: gray;">CARD</h1>
            <h1 style="font-size: 2vh; color: gray; margin-left: 22vw;">Quentity</h1>
            <h1></h1>
        </div>
        <div class="cards">
            <% if (cart && cart.products.length> 0) { %>
                <% let totalAmount=0; %> <!-- Initialize total amount -->
                    <% cart.products.forEach(cartItem=> { %>
                        <div id="card2"
                            style="display: flex; align-items: center; justify-content:space-between; padding: 50px 20px; border-bottom: 1px solid gray;">
                            <h1 style="font-size: 20px; font-weight: 500; text-transform: capitalize; width: 30%;">
                                <%= cartItem.productId.producttitle %>
                            </h1>
                            <div class="addcard" style="display: flex; gap: 25px;">

                                <!-- Decrease quantity button -->
                                <form  action="/update-quantity/<%= cartItem.productId._id %>" method="POST">
                                <input type="hidden" name="action" value="decrease">
                                <button  style="border: none;"  type="submit"><i style="background-color:#111; color: #fff; border: 1px solid #111;" class="ri-subtract-line"></i></button>
                            </form>
                            <h1 style="font-size: 1vw; font-weight: 400;">
                                <%= cartItem.quantity %>
                            </h1>

                                <!-- Increase quantity button -->
                                <form action="/update-quantity/<%= cartItem.productId._id %>" method="POST">
                                <input type="hidden" name="action" value="increase">
                                <button  style="border: none;" type="submit"><i style="background-color:#111; color: #fff; border: 1px solid #111;" class="ri-add-line"></i></button>
                            </form>
                                <!-- Decrease quantity button -->
                                <!-- <button onclick="updateQuantity('<%= cartItem.productId._id %>', 'decrease')"
                                    style="border: none;">
                                    <i style="background-color: #111; color: #fff; border: 1px solid #111;"
                                        class="ri-subtract-line"></i>
                                </button>
                                <h1 id="quantity-<%= cartItem.productId._id %>"
                                    style="font-size: 1vw; font-weight: 400;">
                                    <%= cartItem.quantity %>
                                </h1> -->
                                <!-- Increase quantity button -->
                                <!-- <button onclick="updateQuantity('<%= cartItem.productId._id %>', 'increase')"
                                    style="border: none;">
                                    <i style="background-color: #111; color: #fff; border: 1px solid #111;"
                                        class="ri-add-line"></i>
                                </button> -->
                            </div>
                            <div class="amt" style="display: flex; align-items: center; gap: 50px;">
                                <h1 style="font-size: 20px; font-weight: 100;">$<%= cartItem.productId.pPrice %>
                                </h1>
                                <!-- <a style="text-decoration: none; color: #fff;" href="/card"><i
                                    class="fa-solid fa-xmark"></i></a> -->
                                <form action="/delete-from-cart/<%= cartItem.productId._id %>" method="POST"
                                    style="margin: 0;">
                                    <button style="border: none; background-color: transparent;" type="submit">
                                        <i style="color: #fff;" class="fa-solid fa-xmark"></i>
                                    </button>
                                </form>
                            </div>
                            <!-- Delete button -->


                        </div>
                        <% totalAmount +=cartItem.quantity * cartItem.productId.pPrice; %>
                            <!-- Calculate total amount -->
                            <!-- Display total amount -->
                            <% }) %>



        </div>

        <div class="card3"
            style="display: flex; justify-content: space-between; align-items: start; padding: 20px 20px;">
            <h1 style="font-size: 15px; color: gray;">ADD A PERSONALISED CARD FOR THAT SOMEONE SPECIAL FOR JUST $5.</h1>
            <div class="delevery" style="padding-left: 260px;">
                <h1 style="color: gray; font-size: 15px;padding-bottom: 10px;">DELIVERY</h1>
                <h1 style="color: gray; font-size: 15px;">SUBTOTAL</h1>
            </div>
            <div class="amt2" style="display: flex; justify-content: end;flex-direction: column; align-items: end;">
                <h1 style="font-size: 15px; font-weight: 500;">SHIPPING CALCULATION AT CHECK-OUT.</h1>
                <div style="text-align: right; padding: 20px 50px; font-size: 20px; font-weight: 600;">
                    $<%= totalAmount.toFixed(2) %>
                </div>
            </div>

        </div>


        <% } else { %>
            <p>Your cart is empty.</p>
            <% } %>
                <div class="card4">
                    <a class="ChecBtn" href="/add-to-cart2">CHECKOUT</a>
                </div>
                <div class="card5"
                    style="margin-top: 200px; font-size: 3vw;width: 70%;padding-left:20px ; background-color: #111;">
                    <h2 style="font-family: 900; color: #f2eaea;">THANK YOU FOR WALKING
                        ALONGSIDE VULNERABLE
                        WOMEN AS THEY FIND THEIR
                        WAY HOME AGAIN.</h2>
                </div>
    </div>

    <script>
        // function updateQuantity(productId, action) {
        //     fetch(`/update-quantity/${productId}`, {
        //         method: 'POST',
        //         headers: {
        //             'Content-Type': 'application/json'
        //         },
        //         body: JSON.stringify({ action: action })
        //     })
        //     .then(response => response.json())
        //     .then(data => {
        //         if (data.success) {
        //             // Update the quantity displayed on the page
        //             document.getElementById(`quantity-${productId}`).textContent = data.newQuantity;
        //         } else {
        //             console.error('Failed to update quantity');
        //         }
        //     })
        //     .catch(error => console.log('Error:', error));
        // }
        // </script>



<!-- 
    <script>



        // let arr = [
        //     { product: "CHNAGE THE COUSER COOK KIT", price: "$95" },
        //     { product: "THE COUSER COOK KIT", price: "$50" },
        // ];


        // function cardproduct() {
        //     let cultter = ""
        //     arr.forEach(function (val, index) {
        //         cultter += `<div id="card2"
        //     style="display: flex; align-items: center; justify-content:space-between; padding: 50px 10px; border-bottom: 1px solid gray; margin: 0px 20px;">
        //         <h1 style="font-size: 20px; font-weight: 500;">${val.product}</h1>
        //         <div class="addcard" style="display: flex; gap: 25px; padding-left: 280px;">
        //             <!-- <%- include("shared.ejs") -%> -->
        //             <form action="/add-to-card" method="post">
        //                 <a class="minus" href="#" style="text-decoration: none; color: #fff;">-</a>
        //                 <a data-index="${index}" class="num" href="#"
        //                     style="text-decoration: none; color: #fff;padding-left: 20px;padding-right: 20px;">1</a>
        //                 <a class="plus" href="#" style="text-decoration: none; color: #fff;">+</a>
        //             </form>
        //         </div>
        //         <div class="amt" style="display: flex; align-items: center; gap: 50px;">
        //             <h1 style="font-size: 20px; font-weight: 100;">${val.price}</h1>
        //             <a style="text-decoration: none; color: #fff;" href="/card"><i class="fa-solid fa-xmark"></i></a>
        //         </div>
        // </div>  `


        //     })
        //     document.querySelector(".main .cards").innerHTML = cultter;
        // }

        // cardproduct();





        // let plusbtn = document.querySelector(".main .plus");
        // let numbtn = document.querySelector(".main .num");
        // let minusbtn = document.querySelector(".main .minus");
        // let pricebtn = document.querySelector(".main .price");





        // let a = 1;
        // let p = 1;
        // plusbtn.addEventListener("click", () => {
        //     a++;
        //     p++;
        //     numbtn.innerHTML = a;
        //     pricebtn.innerHTML = p * 95;
        //     if (a < 0) {
        //         numbtn.innerHTML = 0;
        //         pricebtn.innerHTML = 0;
        //     }
        // });

        // minusbtn.addEventListener("click", () => {
        //     a--;
        //     p--;
        //     numbtn.innerHTML = a;
        //     pricebtn.innerHTML = p * 95;
        //     if (a < 0) {
        //         numbtn.innerHTML = 0;
        //         pricebtn.innerHTML = 0;
        //     };
        // });


        function updateQuantity(productId, action) {
            fetch(`/update-quantity/${productId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ action: action })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Update the quantity displayed on the page
                        document.getElementById(`quantity-${productId}`).textContent = data.newQuantity;

                        // Optionally update the total amount if you have a total amount element
                        // document.getElementById('total-amount').textContent = data.newTotalAmount;
                    } else {
                        console.error('Failed to update quantity');
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        updateQuantity()




    </script> -->

    <% include ./partial/footer.ejs %>